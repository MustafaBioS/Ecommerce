<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecommerce - Cart</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css')}}">
    <link rel="icon" href="{{ url_for('static', filename='4804045.png')}}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
</head>

{% if not cart %}
<body style="overflow: hidden;">
{% else %}
    <body style="overflow: auto;"></body>
{% endif %}
    <nav class="nvb">
        <div class="left">
            <h1 class="ecom">Ecommerce</h1>
            <h1 class="hm hme anim">Home</h1>
            <h1 class="nvsh anim">Shop All</h1>
            <h1 class="txt refund anim">Refund</h1>
            <h1 class="txt contact anim">Contact Us</h1>
            {% if current_user.is_admin %}
                <h1 class="txt admin anim">Admin</h1>
            {% endif %}
        </div>

        <div class="right">
            <img src="{{ url_for('static', filename='user.png')}}" class="prof icon">
            <img src="{{ url_for('static', filename='cart.png')}}" class="cart icon">
            <img src="{{ url_for('static', filename='menu.png')}}" class="menu icon">
        </div>
    </nav>

    <div class="cartCon">
        <h1 class="cartTitle">Your Cart</h1>
        {% if cart %}
            {% for item in cart %}
                <div class="itemDiv">
                    <img class="itemImg" src="{{ url_for('upload', filename=item.pic)}}" alt="{{ item.name }}">
                    <div class="deets">
                        <h3>{{ item.name }}</h3>
                        <p>{{ item.price }} EGP</p>
                        <p>Quantity: {{ item.quantity }}</p>
                    </div>
                    <div class="deleteDiv">
                        <img class="cartDel" src="{{ url_for('static', filename='trash.png')}}" alt="Trash" data-cart-id="{{ item.cart_id }}">
                    </div> 
                </div>
            {% endfor %}

            <div class="totalCon">
                <div class="totalDiv">
                    <h1>Subtotal</h1>
                    <span class="total">{{ total }} EGP</span>
                </div>
                <button class="checkout">Checkout</button>
            </div>


            {% else %}
            <div class="centerNone">
                <h1 class="none">Your Cart Is Empty</h1>
            </div>
        {% endif %}
    </div>
    

    <div class="menuBox">
        <h1 class="hmnm mobAnim">Home</h1>
        <h1 class="nvshn nvshnm mobAnim">Shop All</h1>
        <h1 class="txt refundnm mobAnim">Refund</h1>
        <h1 class="txt contactnm mobAnim">Contact Us</h1>
        {% if current_user.is_admin %}
            <h1 class="txt adminnm mobAnim">Admin</h1>
        {% endif %}
    </div>


    <div class="refundCon">
        <div class="refundBox">
            <div class="xCon">
                <h1 class="x">X</h1>
            </div>
            <h1 class="retitle">Start Your Request</h1>
            <p class="redesc">Quick Returns, Smooth Exchanges.</p>
            <form action="{{ url_for('refund')}}" class="reform" method="post">
                <label class="lb on">Order Number</label>
                <input type="text" placeholder="#1234567" class="orderNum inp" name="orderNum" maxlength="7" required>
                <label class="lb">Last 4 Digits Of Phone</label>
                <input type="text" inputmode="numeric" maxlength="4" pattern="\d*" placeholder="1234" class="phoneNum inp" name="phoneNum" required>
                <input type="submit" class="sub" value="Refund Order">
            </form>
        </div>
    </div>

    <div class="overlayed"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script>
        const ecom = document.querySelector('.ecom');
        const home = document.querySelector('.hm');
        const refund = document.querySelector('.refund');
        const overlay = document.querySelector('.overlayed');
        const refundCon = document.querySelector('.refundCon');
        const refundBox = document.querySelector('.refundBox');
        const contact = document.querySelector('.contact');
        const x = document.querySelector('.x');
        const phoneNum = document.querySelector(".phoneNum");
        const all = document.querySelector('.nvsh');
        const menu = document.querySelector('.menu');
        const menuBox = document.querySelector('.menuBox');

        const homenm = document.querySelector('.hmnm');
        const refundnm = document.querySelector('.refundnm');
        const contactnm = document.querySelector('.contactnm');
        const allnm = document.querySelector('.nvshnm');

        const profile = document.querySelector(".prof");
        const cart = document.querySelector('.cart');

        const admin = document.querySelector('.admin');
        const adminnm = document.querySelector('.adminnm');

        const cartDel = document.querySelectorAll('.cartDel') 
        const checkout = document.querySelector('.checkout');

        checkout.addEventListener('click', ()=> {
            window.location.href = "/checkout";
        })
        
        cartDel.forEach(btn => {
            btn.addEventListener('click', () => {
                const cartId = btn.dataset.cartId;
                window.location.href = `/cart/delete/${cartId}`;
            });
        });

        if (admin && adminnm) {
            admin.addEventListener('click', ()=> {
                window.location.href = "{{ url_for('admin')}}";
            })

            adminnm.addEventListener('click', ()=> {
                window.location.href = "{{ url_for('admin')}}";
            })
        }


        cart.addEventListener('click', ()=> {
            window.location.href = "{{ url_for('cart')}}";
        })

        profile.addEventListener('click', ()=> {
            window.location.href = "{{ url_for('profile')}}";
        });

        homenm.addEventListener('click', ()=> {
            window.location.href = "{{ url_for('home') }}";
        });

        refundnm.addEventListener('click', ()=> {
            menuBox.classList.remove('show')

            refundBox.classList.add('show');
            overlay.classList.add('show');
        });

        contactnm.addEventListener('click', ()=> { {
            window.location.href = "{{ url_for('contact') }}";
        }});

        all.addEventListener('click', ()=> {
            window.location.href = "{{ url_for('all')}}";
        })

        allnm.addEventListener('click', ()=> {
            menuBox.classList.remove('show');
        });

        menu.addEventListener('click', ()=> {
            if (menuBox.classList.contains('show')) {
                menuBox.classList.remove('show');
            }

            else {
                menuBox.classList.add('show');
            }
        });

        contact.addEventListener('click', ()=> {
            window.location.href = "{{ url_for('contact')}}"
        })

        phoneNum.addEventListener("input", () => {
            phoneNum.value = phoneNum.value.replace(/\D/g, '').slice(0, 4);
        });

        refund.addEventListener('click', ()=> {
            refundBox.classList.add('show');
            overlay.classList.add('show');
        });

        x.addEventListener('click', ()=> {
            refundBox.classList.remove('show');
            overlay.classList.remove('show');
        })

        document.addEventListener('click', (e)=> {
            if (refundBox.classList.contains("show") && !refund.contains(e.target) && !refundnm.contains(e.target) && !refundBox.contains(e.target)) {
                refundBox.classList.remove('show')
                overlay.classList.remove('show');
            }
        })

        home.addEventListener('click', ()=> {
            window.location.href = "{{ url_for('home')}}"
        })

        ecom.addEventListener('click', ()=> {
            window.location.href = "{{ url_for('home')}}"
        })
    </script>
</body>
</html>