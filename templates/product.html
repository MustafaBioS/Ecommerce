<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecommerce - {{ product.name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css')}}">
    <link rel="icon" href="{{ url_for('static', filename='4804045.png')}}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

</head>
<body>
    <nav class="nvb">
        <div class="left">
            <h1 class="ecom">Ecommerce</h1>
            <h1 class="hm hme anim">Home</h1>
            <h1 class="nvsh anim">Shop All</h1>
            <h1 class="txt refund anim">Refund</h1>
            <h1 class="txt contact anim">Contact Us</h1>
            {% if current_user.is_admin %}
                <h1 class="txt admin anim">Admin</h1>
            {% endif %}
        </div>

        <div class="right">
            <img src="{{ url_for('static', filename='user.png')}}" class="prof icon">
            <img src="{{ url_for('static', filename='cart.png')}}" class="cart icon">
            <img src="{{ url_for('static', filename='menu.png')}}" class="menu icon">
        </div>
    </nav>

    <div class="menuBox">
        <h1 class="hmnm mobAnim">Home</h1>
        <h1 class="nvshnm mobAnim">Shop All</h1>
        <h1 class="txt refundnm mobAnim">Refund</h1>
        <h1 class="txt contactnm mobAnim">Contact Us</h1>
        {% if current_user.is_admin %}
            <h1 class="txt adminnm mobAnim">Admin</h1>
        {% endif %}
    </div>

    <div class="refundCon">
        <div class="refundBox">
            <div class="xCon">
                <h1 class="x">X</h1>
            </div>
            <h1 class="retitle">Start Your Request</h1>
            <p class="redesc">Quick Returns, Smooth Exchanges.</p>
            <form action="{{ url_for('refund')}}" class="reform" method="post">
                <label class="lb on">Order Number</label>
                <input type="text" placeholder="#1234567" class="orderNum inp" name="orderNum" maxlength="7" required>
                <label class="lb">Last 4 Digits Of Phone</label>
                <input type="text" inputmode="numeric" maxlength="4" pattern="\d*" placeholder="1234" class="phoneNum inp" name="phoneNum" required>
                <input type="submit" class="sub" value="Refund Order">
            </form>
        </div>
    </div>

    <div class="overlayed"></div>
    
    <div class="productContainer">
        <div class="leftPro">
            <div class="carousel">
                <div class="carousel-track">
                    {% for pic in [product.first_pic, product.second_pic, product.third_pic, product.fourth_pic, product.size_chart] %}
                        {% if pic %}
                            <div class="carousel-slide">
                                <img src="{{ url_for('upload', filename=pic) }}" alt="Product Image">
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>

                <button class="carousel-btn prev">&lt;</button>
                <button class="carousel-btn next">&gt;</button>
            </div>
        </div>

        <div class="rightPro">
            <h1 class="proTitle">{{ product.name }}</h1>
            <h2 class="proPrice">${{ product.price }}</h2>

            <h3 class="proSize">Size</h3>
            <form action="" method="post">
                <div class="size-options">
                    <label class="size-btn">
                    <input class="rdb" type="radio" name="size" value="S">
                    <span>S</span>
                    </label>

                    <label class="size-btn">
                    <input class="rdb" type="radio" name="size" value="M">
                    <span>M</span>
                    </label>

                    <label class="size-btn">
                    <input class="rdb" type="radio" name="size" value="L">
                    <span>L</span>
                    </label>
                </div>

                <label class="lb" style="margin-top: 15px;">Quantity</label>
                <div class="quantityBox" data-id="{{ product.id }}">
                    <input type="number" name="quantity" class="quantityInp" hidden>
                    <h2 class="plus">+</h2>
                    <h1 class="number">1</h1>
                    <h2 class="minus">-</h2>
                </div>

                <button class="adt">Add To Cart</button>
            </form>

        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script>
        const ecom = document.querySelector('.ecom');
        const home = document.querySelector('.hm');
        const refund = document.querySelector('.refund');
        const overlay = document.querySelector('.overlayed');
        const refundCon = document.querySelector('.refundCon');
        const refundBox = document.querySelector('.refundBox');
        const contact = document.querySelector('.contact');
        const x = document.querySelector('.x');
        const phoneNum = document.querySelector(".phoneNum");
        const all = document.querySelector('.nvsh');
        const menu = document.querySelector('.menu');
        const menuBox = document.querySelector('.menuBox');

        const homenm = document.querySelector('.hmnm');
        const refundnm = document.querySelector('.refundnm');
        const contactnm = document.querySelector('.contactnm');
        const allnm = document.querySelector('.nvshnm');

        const profile = document.querySelector(".prof");
        const cart = document.querySelector('.cart');

        const admin = document.querySelector('.admin');
        const adminnm = document.querySelector('.adminnm');
        const carous = document.querySelectorAll('.carousel')
        const sizeBtn = document.querySelectorAll('.size-btn');
        const rdb = document.querySelectorAll (".rdb");
        const box = document.querySelector(".quantityBox");
        const plus = box.querySelector(".plus");
        const minus = box.querySelector(".minus");
        const number = box.querySelector(".number");
        const input = box.querySelector(".quantityInp");
        
        document.querySelectorAll('.adt').forEach(button => {
            button.addEventListener('click', async (e) => {
                e.preventDefault();

                const form = button.closest('form');
                const quantityBox = form.querySelector('.quantityBox');
                const quantity = parseInt(quantityBox.querySelector('.number').textContent);
                const item_id = parseInt(quantityBox.dataset.id);

                const selectedSizeInput = form.querySelector('.rdb:checked');
                if (!selectedSizeInput) {
                    alert("Please select a size!");
                    return;
                }
                const size = selectedSizeInput.value;

                const payload = [{
                    id: item_id,
                    quantity: quantity,
                    size: size
                }];

                const res = await fetch("/cart", {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({cart: payload})
                });

                const data = await res.json();

                if (data.status === "ok") {
                    alert(`Added ${quantity} item(s) to cart!`);
                } else {
                    alert("Error adding to cart!");
                }
            });
        });

        let value = 1;
        input.value = value;

        plus.addEventListener("click", () => {
            if (value >= "{{ product.quantity }}") {
                value = "{{ product.quantity }}";
            }
            else {
                value++;
                update();
            }
        });

        minus.addEventListener("click", () => {
            if (value > 1) {
                value--;
                update();
            }
        });

        function update() {
            number.textContent = value;
            input.value = value;
        }

        rdb.forEach((radio, index) => {
            radio.addEventListener('change', () => {
                sizeBtn.forEach(btn => {
                    btn.style.backgroundColor = 'white';
                    btn.style.color = 'black';
        });

        if (radio.checked) {
            sizeBtn[index].style.backgroundColor = 'black';
            sizeBtn[index].style.color = 'white';
        }
    });
});

        carous.forEach(carousel => {
            const track = carousel.querySelector('.carousel-track');
            const slides = Array.from(track.children);
            const prevBtn = carousel.querySelector('.prev');
            const nextBtn = carousel.querySelector('.next');
            let index = 0;

            function updateSlide() {
                track.style.transform = `translateX(-${index * 100}%)`;
            }

            nextBtn.addEventListener('click', () => {
                index = (index + 1) % slides.length;
                updateSlide();
            });

            prevBtn.addEventListener('click', () => {
                index = (index - 1 + slides.length) % slides.length;
                updateSlide();
            });
        });


        if (admin && adminnm) {
            admin.addEventListener('click', ()=> {
                window.location.href = "{{ url_for('admin')}}";
            })

            adminnm.addEventListener('click', ()=> {
                window.location.href = "{{ url_for('admin')}}";
            })
        }


        cart.addEventListener('click', ()=> {
            window.location.href = "{{ url_for('cart')}}";
        })

        profile.addEventListener('click', ()=> {
            window.location.href = "{{ url_for('profile')}}";
        });

        homenm.addEventListener('click', ()=> {
            window.location.href = "{{ url_for('home') }}";
        });

        refundnm.addEventListener('click', ()=> {
            menuBox.classList.remove('show')

            refundBox.classList.add('show');
            overlay.classList.add('show');
        });

        contactnm.addEventListener('click', ()=> { {
            window.location.href = "{{ url_for('contact') }}";
        }});

        all.addEventListener('click', ()=> {
            window.location.href = "{{ url_for('all')}}";
        })

        allnm.addEventListener('click', ()=> {
            menuBox.classList.remove('show');
        });

        menu.addEventListener('click', ()=> {
            if (menuBox.classList.contains('show')) {
                menuBox.classList.remove('show');
            }

            else {
                menuBox.classList.add('show');
            }
        });

        all.classList.add('chosen');

        contact.addEventListener('click', ()=> {
            window.location.href = "{{ url_for('contact')}}"
        })

        phoneNum.addEventListener("input", () => {
            phoneNum.value = phoneNum.value.replace(/\D/g, '').slice(0, 4);
        });

        refund.addEventListener('click', ()=> {
            refundBox.classList.add('show');
            overlay.classList.add('show');
        });

        x.addEventListener('click', ()=> {
            refundBox.classList.remove('show');
            overlay.classList.remove('show');
        })

        document.addEventListener('click', (e)=> {
            if (refundBox.classList.contains("show") && !refund.contains(e.target) && !refundnm.contains(e.target) && !refundBox.contains(e.target)) {
                refundBox.classList.remove('show')
                overlay.classList.remove('show');
            }
        })

        home.addEventListener('click', ()=> {
            window.location.href = "{{ url_for('home')}}"
        })

        ecom.addEventListener('click', ()=> {
            window.location.href = "{{ url_for('home')}}"
        }) 
    </script>
</body>
</html>